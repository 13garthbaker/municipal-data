{% extends '_base.html' %}
{% load staticfiles pipeline l10n jsonify finance %}

{% block head_title %}{{ geography.name  }} - {{ block.super }}{% endblock %}
{% block head_meta_description %}Financial Performance for {{ geography.name }}, and other information.{% endblock %}

{% block head_facebook_tags %}
    <meta property="og:title" content="Municipal Money Profile: {% firstof geography.name %}" />
    <meta property="og:site_name" content="Municipal Money" />
    <meta property="og:description" content="Financial Performance for {{ geography.name }}, and other information." />
    <meta property="og:type" content="article" />
{% endblock %}

{% block body_id %}profile{% endblock %}

{% block header_content %}
  <div id="cover-map" class="clearfix">
    <div id="slippy-map"></div>
    <div id="cover-profile">
      <article class="clearfix column-half">
        <header id="header-box" class="column-full">
          <h1 class="title">{{ geography.name }}</h1>
          <p class="caption">
            {{ geography.category_name|capfirst }}
            in
            {% if geography.ancestors %}
              {% for g in geography.ancestors %}
                <a href="/profiles/{{ g.geoid }}-{{ g.name|slugify }}/">{{ g.name }}</a>,
              {% endfor %}
            {% endif %}
            {{ geography.province_name }}
          </p>
        </header>
        <div class="stat stat-primary">
          <span class="name">Population</span>
          <span class="value">{{ total_population|floatformat:"0" }}</span>
        </div>
        {% if geography.square_kms %}
        <div class="stat stat-secondary">
          <span class="value">{% if geography.square_kms < 1.0 %}{{ geography.square_kms|floatformat:"3" }}{% else %}{{ geography.square_kms|floatformat:"1" }}{% endif %}</span>
          <span class="name"> square kilometres</span>
        </div>
          {% if population_density %}
          <div class="stat stat-secondary">
            <span class="value">{{ population_density|floatformat:"1" }}</span>
            <span class="name"> people per square kilometre</span>
          </div>
          {% endif %}
        {% endif %}
      </article>
    </div>
  </div>

  <div id="about">
    <div class="container">
      <div class="sub-section" id="who-runs">
        <div class="row">
          <div class="col-md-4 col-md-push-8">
            <ul class="fa-ul">
              <li>
                <i class="fa fa-li fa-phone" aria-hidden="true"></i> <a href="tel:{{ muni_contact.phone_number }}">{{ muni_contact.phone_number }}</a>
              </li>
              {% if muni_contact.url %}
              <li>
                <i class="fa fa-li fa-globe" aria-hidden="true"></i> <a href="{{ muni_contact.url|lower }}" target="_blank">{{ muni_contact.url|lower }}</a>
              </li>
              {% endif %}
              <li>
                <i class="fa fa-li fa-map-marker" aria-hidden="true"></i>
                {% if muni_contact.street_address_1 %}{{ muni_contact.street_address_1 }}<br>{% endif %}
                {% if muni_contact.street_address_2 %}{{ muni_contact.street_address_2 }}<br>{% endif %}
                {% if muni_contact.street_address_3 %}{{ muni_contact.street_address_3 }}<br>{% endif %}
                {% if muni_contact.street_address_4 %}{{ muni_contact.street_address_4 }}{% endif %}
              </li>
            </ul>
          </div>
          <div class="col-md-8 col-md-pull-4">
            <div class="row">
              {% for official in mayoral_staff.officials %}
                {% if forloop.counter < 5 %}
                <div class="col-sm-3">
                  <div class="person-info">
                    <div class="person-role">{{ official.role }}</div>
                    <ul class="fa-ul person-name">
                      {% if official and official.name %}
                      <li><i class="fa fa-li fa-user" aria-hidden="true"></i> {{ official.title|default:'' }} {{ official.name }}</li>
                      {% endif %}
                    </ul>
                    <div class="person-contact-details">
                      {% with details=official.secretary|default:official %}
                      {% if details.name %}
                      <a href="#contact-details-{{ forloop.counter }}" data-toggle="collapse" class="show-contact-details show-more"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Contact Details</a>
                      <div class="contact-details collapse" id="contact-details-{{ forloop.counter }}">
                        {% if official.secretary and official.secretary.name %}
                        <div>
                          <h4>Secretary</h4>
                          {{ official.secretary.title|default:'' }} {{ official.secretary.name }}
                        </div>
                        {% endif %}

                        <ul class="fa-ul">
                            {% if details.office_phone %}
                            <li>
                              <i class="fa fa-li fa-phone" aria-hidden="true"></i> <a href="tel:{{ details.office_phone }}">{{ details.office_phone }}</a>
                            </li>
                            {% endif %}
                            {% if details.email %}
                            <li>
                              <i class="fa fa-li fa-envelope" aria-hidden="true"></i> <a href="mailto:{{ details.email }}">{{ details.email }}</a>
                            </li>
                            {% endif %}
                          </ul>
                      </div>
                      {% endif %}
                      {% endwith %}
                    </div>
                  </div>
                </div>
                {% endif %}
              {% endfor %}
            </div>

            {% if mayoral_staff.updated_date %}
            Last updated: {{ mayoral_staff.updated_date }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% block page-nav %}
  <nav class="page-nav-wrapper">
    <div class="page-nav-container">
      <div class="container">
        <div class="page-nav-info">
          <div class="muni-name">{{ geography.name }}</div>
          <div class="muni-population">Population: {{ total_population|floatformat:"0" }}</div>
        </div>

        <ul class="nav nav-pills" id="page-nav">
          <li role="presentation" class="active"><a href="#performance"><i class="fa fa-line-chart fa-2x" aria-hidden="true"></i><br><span class="nav-text">Financial<br>Performance</span></a></li>
          <li role="presentation"><a href="#income"><i class="fa fa-money fa-2x" aria-hidden="true"></i><br><span class="nav-text">Income</span></a></li>
          <li role="presentation"><a href="#spending"><i class="fa fa-credit-card fa-2x" aria-hidden="true"></i><br><span class="nav-text">Spending</span></a></li>
          <li role="presentation" class="pull-right hidden-xs"><a href="/profiles/{{ geography.geo_level }}-{{ geography.geo_code }}-{{ geography.slug }}.pdf" target="_blank" rel="alternate" type="application/pdf"><i class="fa fa-print fa-2x" area-hidden="true"></i><br><span class="nav-text">Print PDF</span></a></li>
        </ul>

      </div>
    </div>
  </nav>
  {% endblock %}
{% endblock %}

{% block content %}

<div id="explainer-video">
  <div class="video-preview video-preview-lg">
    <a href="#video-modal" data-toggle="modal">
      <div class="video-image" style="background-image: url('{% static 'img/video-placeholder.jpg' %}');">
        <div class="video-image-inner">
          <div class="play-button-wrapper">
            <img src="{% static 'img/play-button-overlay.png' %}" class="play-button">
          </div>
          <div class="video-description">
            <strong>Municipal Finance</strong> in 5 Minutes
          </div>
        </div>
      </div>
    </a>
  </div>

  <!-- Video Modal -->
  <div class="modal fade" id="video-modal" tabindex="-1" role="dialog" aria-labelledby="VideoModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <a class="btn close" href="#" data-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></a>
          <h4 class="modal-title">Municipal Finance in 5 Minutes</h4>
        </div>
        <div class="modal-body">{% include "_videos.html" %}</div>
      </div>
    </div>
  </div>

</div>

{% include 'profile/_performance.html' %}

<div class="section" id="income">
  <h1><i class="fa fa-money"></i> Income <span class="subtitle">- Where money comes from</span></h1>

  <div class="indicator">
    <div class="row">
      <div class="col-sm-8">
        <div class="chart-container narrow-margin" data-chart="grouped-bar-revenue_breakdown" data-unit="currency"></div>
        <div class="show-calc"><a href="#income-calc" data-toggle="collapse" class="show-more"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show Source</a></div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-didyouknow">
          <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
          <div class="panel-body">
            <p>This indicator compares how much of a municipality's income it is able to generate itself (through property rates, service charges, etc), compared with how much it receives as transfers and grants from national government.  The more a municipality is able to generate its own income, the more self-sufficient it is.  Municipalities should not be too reliant on transfers and grants from other spheres of government.  If they have to rely on transfers for over half of their total operating revenue it is a clear sign of financial risk.  Municipalities should aim to generate at least 75 percent of their own revenue. </p>
          </div>
        </div>
      </div>
    </div>
    <div class="calc collapse" id="income-calc">
      <h5>Source:</h5>

      <ul class="formula">
        <li>
          <a href="{% table_url "incexp" %}" target="_blank">Income & Expenditure</a> Audited Actual and Original Budget
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="section" id="spending">
  <h1><i class="fa fa-credit-card"></i> Spending <span class="subtitle">- How money is spent</span></h1>

  <div class="indicator">
    {% with indicators.expenditure_trends.staff.values|first as latest %}
    <h2>Staff Wages and Salaries <span class="indicator-date">{{ latest.date|finyear }}</span></h2>

    <div class="row">
      <div class="col-sm-4">
        <div class="indicator-value rating rating-{{ latest.rating }}">{% if latest.result == None %}Not available{% else %}{{ latest.result }}%{% endif %}</div>
        <div class="indicator-description">Staff salaries and wages as a percentage of operating expenditure.</div>
        <table class="indicator-key">
          <tr>
            <td class="key-symbol rating rating-good">good</td>
            <td class="key-description">25% to 40%</td>
          </tr>
          <tr>
            <td class="key-symbol rating rating-ave">average</td>
            <td class="key-description">less than 25% or more than 40%</td>
          </tr>
        </table>
        <div class="show-calc"><a href="#staff-exp-calc" data-toggle="collapse" class="show-more"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show Calculation</a></div>
      </div>
      <div class="col-sm-4">
        <div class="chart-container" data-chart="column-expenditure_trends.staff" data-unit="percent"></div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-didyouknow">
          <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
          <div class="panel-body">
            <p>Employee-related costs are typically the largest portion of operating expenditure, but they should not grow so large that they threaten the sustainability of the operating budget.</p>
            <p>The normal range for this indicator is between 25% - 40% of total operating expenditure.  Municipalities must guard against spending too much on staff while also making sure they have the people they need to deliver services effectively.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="calc collapse" id="staff-exp-calc">
      <h5>Formula:</h5>

      <ul class="formula">
        <li>= Wages & Salaries + Social Contributions / Actual Operating Expenditure</li>
        <li>=
          <a href="{% table_url "incexp" year=latest.date items="3000,3100" amountType="AUDA" %}" target="_blank">Income & Expenditure item codes 3000, 3100, Audited Actual</a>
          /
          <a href="{% table_url "incexp" year=latest.date items=4600 amountType="AUDA" %}" target="_blank">Income & Expenditure item code 4600, Audited Actual</a>
      </ul>
    </div>
    {% endwith %}
  </div>

  <div class="indicator">
    {% with indicators.expenditure_trends.contracting.values|first as latest %}
    <h2>Contractor Services <span class="indicator-date">{{ latest.date|finyear }}</span></h2>

    <div class="row">
      <div class="col-sm-4">
        <div class="indicator-value rating rating-{{ latest.rating }}">{% if latest.result == None %}Not available{% else %}{{ latest.result }}%{% endif %}</div>
        <div class="indicator-description">Costs of contractor services as a percentage of operating expenditure.</div>
        <table class="indicator-key">
          <tr>
            <td class="key-symbol rating rating-good">good</td>
            <td class="key-description">up to 5%</td>
          </tr>
          <tr>
            <td class="key-symbol rating rating-bad">bad</td>
            <td class="key-description">more than 5%</td>
          </tr>
        </table>
        <div class="show-calc"><a href="#contracting-exp-calc" data-toggle="collapse" class="show-more"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show Calculation</a></div>
      </div>
      <div class="col-sm-4">
        <div class="chart-container" data-chart="column-expenditure_trends.contracting" data-unit="percent"></div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-didyouknow">
          <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
          <div class="panel-body">
            <p>Private contractors are sometimes needed for certain work, but they are usually more expensive than municipal staff.  This should be kept to a minimum and efforts should be made to provide services in-house, where possible.</p>
            <p>This measure is normally between 2 percent and 5 percent of total operating expenditure.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="calc collapse" id="contracting-exp-calc">
      <h5>Formula:</h5>

      <ul class="formula">
        <li>= Contracted Services / Actual Operating Expenditure</li>
        <li>=
          <a href="{% table_url "incexp" year=latest.date items="4200" amountType="AUDA" %}" target="_blank">Income & Expenditure item code 4200, Audited Actual</a>
          /
          <a href="{% table_url "incexp" year=latest.date items=4600 amountType="AUDA" %}" target="_blank">Income & Expenditure item code 4600, Audited Actual</a>
      </ul>
    </div>
    {% endwith %}
  </div>

  <div class="indicator">
    <h2>What is Money Spent On?</h2>

    <div class="row">
      <div class="col-sm-8">
        <div class="chart-container" data-chart="grouped-bar-expenditure_functional_breakdown" data-unit="currency"></div>
        <div class="show-calc"><a href="#expenditure-calc" data-toggle="collapse" class="show-more"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show Source</a></div>
      </div>

      <div class="col-sm-4">
        <div class="panel panel-didyouknow">
          <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
          <div class="panel-body">
            Municipalities spend money on providing services and maintaining facilities for their residents.
          </div>
        </div>
      </div>
    </div>

    <div class="calc collapse" id="expenditure-calc">
      <h5>Source:</h5>

      <ul class="formula">
        <li>
          <a href="{% table_url "incexp" %}" target="_blank">Income & Expenditure</a> Audited Actual and Original Budget
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="section">
  <h1><i class="fa fa-book" aria-hidden="true"></i> More Resources</h1>

  <div class="row">
    <div class="col-md-6">
      <h2>Financial Reports</h2>

      <p>Read more about Local Government Finances and learn about how your money is spent.</p>

      <ul>
        <li>
          <a href="http://mfma.treasury.gov.za/Media_Releases/The%20state%20of%20local%20government%20finances/Pages/default.aspx" target="_blank">State of Local Government Finances reports</a> are published every year by National Treasury and describe in detail how Municipalities are performing.
        </li>
        <li>
          <a href="http://mfma.treasury.gov.za/Media_Releases/s71/Pages/default.aspx" target="_blank">In-year Management, Monitoring and Evaluation of Municipal Finances</a>. Annual and quarterly PDF and Excel reports on Municipal finances since 2007.
        </li>
      </ul>

      <br>

      <h2>Understanding Municipal Finance</h2>

      <ul>
        <li>
          <a href="http://mfma.treasury.gov.za/Return_Forms/Pages/default.aspx" target="_blank">MFMA Return Forms</a> submitted by Municipalities to National Treasury. Understanding these forms can help you understand the information on Municipal Money.
        </li>
        <li>
          <a href="http://mfma.treasury.gov.za/Circulars/Pages/Circular71.aspx" target="_blank">Circular 71</a> explains many of the financial norms and indicators used to gauge the financial performance of Municipalities.</a>
        </li>
        <li>
          <a href="http://mfma.treasury.gov.za/Pages/Default.aspx" target="_blank">Treasury's Municipal Finance website</a> is filled with resources on municipal finance.
        </li>
      </ul>
    </div>
  </div>

</div>

{% endblock %}

{% block body_javascript_extra %}
<script src="{% static 'js/head2head.js' %}"></script>

<script type="text/javascript">

  var profileData = {{ profile_data|jsonify|safe }}
  var maps = new Maps();
  maps.drawMapsForProfile(profileData.geography);

</script>

{% endblock %}
