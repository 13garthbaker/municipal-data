{% extends 'profile/profile_detail.html' %}
{% load staticfiles pipeline l10n %}

{% block head_css_extra %}
{{ block.super }}
{% stylesheet "scorecard" %}
{% endblock head_css_extra %}

{% block header_content %}
    <div id="cover-map" class="clearfix">
        <div id="slippy-map"></div>
        <div id="cover-profile" class="wrapper">
            <article class="clearfix column-half">
                <header id="header-box" class="column-full">
                    <h1 class="title">{{ geography.this.short_name }}</h1>
                    <p class="caption">
                      {{ geography.this.geo_level|capfirst }}
                      in
                      {% if geography.parents %}
                          {% for level, g in geography.parents.items %}
                            <a href="/profiles/{{ g.full_geoid }}-{{ g.short_name|slugify }}/">{{ g.short_name }}</a>,
                          {% endfor %}
                      {% endif %}
                      {{ geography.this.province_name }}
                    </p>
                </header>
                <div class="stat stat-primary">
                    <span class="name">Population</span>
                    <span class="value">{{ total_population|floatformat:"0" }}</span>
                </div>
                {% if geography.this.square_kms %}
                <div class="stat stat-secondary">
                    <span class="value">{% if geography.this.square_kms < 1.0 %}{{ geography.this.square_kms|floatformat:"3" }}{% else %}{{ geography.this.square_kms|floatformat:"1" }}{% endif %}</span>
                    <span class="name"> square kilometres</span>
                    {% if demographics.population_density.values.this %}
                    <span class="secondary">
                        <span class="value">{{ demographics.population_density.values.this|floatformat:"1" }}</span>
                        <span class="name"> people per square kilometre</span>
                    </span>
                    {% endif %}
                </div>
                {% endif %}
            </article>
        </div>
    </div>
    {% block page-nav %}
        <div class="page-nav-wrapper">
          <div class="page-nav" data-spy="affix" data-offset-top="281">
            <div class="container">
              <h1 class="title">{{ geography.this.short_name }}</h1>
              <ul class="nav nav-tabs">
                <li role="presentation" class="active"><a href="#"><div class="icon icon-office-04"></div>About</a></li>
                <li role="presentation"><a href="#"><div class="icon icon-office-42"></div>Income</a></li>
                <li role="presentation"><a href="#"><div class="icon icon-shopping-03"></div>Spending</a></li>
                <li role="presentation"><a href="#"><div class="icon icon-office-16"></div>Performance</a></li>
              </ul>
            </div>
          </div>
        </div>
    {% endblock %}
{% endblock %}

{% block content %}

<div class="section" id="about">
  <div class="container">
    <h1>About the municipality</h1>
    <div class="sub-section" id="who-runs">
      <div class="row">
        <div class="col-md-8 separator-right">
          <h2>Who runs the municipality?</h2>
          <div class="row">
            {% for official in mayoral_staff %}
              <div class="col-md-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="2">{{ official.role }}</th>
                  </tr>
                  <tr class="text-large">
                    <td class="cell-min"><i class="fa fa-user" aria-hidden="true"></i></td>
                    <td>{{ official.title }} {{ official.name }}</td>
                  </tr>
                  <tr class="table-footer">
                    <td colspan="2">+ Show Contact Details</td>
                  </tr>
                </table>
              </div>
            {% endfor %}
          </div>
        </div>
        <div class="col-md-4">
          <h2>Contact details</h2>
          <table class="table table-bordered">
            <tr>
              <td class="cell-min"><i class="fa fa-phone" aria-hidden="true"></i></td>
              <td><a href="tel:{{ muni_contact.phone_number }}">{{ muni_contact.phone_number }}</a></td>
            </tr>
            <tr>
              <td class="cell-min"><i class="fa fa-map-marker" aria-hidden="true"></i></td>
              <td><a href="{{ muni_contact.url }}">{{ muni_contact.url }}</a></td>
            </tr>
            <tr>
              <td class="cell-min"><i class="fa fa-map-marker" aria-hidden="true"></i></td>
              <td>{{ muni_contact.street_address_1 }} <br> {{ muni_contact.street_address_2 }} <br> {{ muni_contact.street_address_3 }} <br> {{ muni_contact.street_address_4 }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sub-section" id="audit-outcomes">
  <h2>Audit outcomes</h2>
  <div class="row">
    <div class="col-md-8">
      <div class="row">
      {% for year, value in audit_opinions.iteritems %}
        <div class="col-md-3">
          <table class="table table-bordered">
            <tr>
              <td class="text-large text-center"><strong>{{ year|unlocalize }} <br>{{ value }}</strong></td>
            </tr>
            <tr class="table-footer">
              <td><a href="#">Read report</a></td>
            </tr>
          </table>
        </div>
      {% endfor %}
      </div>
    </div>
    <div class="col-md-4">
      <div class="panel panel-didyouknow">
        <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
        <div class="panel-body">
          There are <strong>5 types of audit outcomes</strong>:
          <ul>
            <li>A <strong>clean audit</strong> means that there are no irregularities in the municipality's accounting.</li>
          </ul>
          <div class="more"><a href="#"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show More</a></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="section" id="performance">
  <div class="container">
    <h1>Performance</h1>
    <div class="indicator">
      <div class="row">
        <div class="col-md-3">
          {% with cash_coverage|first as current_ratio %}
          <div class="indicator-value {% if current_ratio.result > 3 %}indicator-good{% elif current_ratio < 1 %}indicator-bad{% endif %}">{{ current_ratio.result }} <i class="fa {% if current_ratio.result > 3 %}fa-check{% elif current_ratio < 1 %}fa-warning{% endif %}" aria-hidden="true"></i></div>
          {% endwith %}
          <div class="indicator-description">months of operating expenses can be paid for with the cash available.</div>
          <table class="table table-bordered indicator-key">
            <tr>
              <td class="key-symbol indicator-good">good <i class="fa fa-check" aria-hidden="true"></i></td>
              <td class="key-description">more than 3</td>
            </tr>
            <tr>
              <td class="key-symbol indicator-bad">bad <i class="fa fa-warning" aria-hidden="true"></i></td>
              <td class="key-description">less than 1</td>
            </tr>
          </table>
        </div>
        <div class="col-md-5">
          [chart]
        </div>
        <div class="col-md-4">
          <div class="panel panel-didyouknow">
            <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
            <div class="panel-body">
              A <strong>low value</strong> shows that the municipality may be unable to pay for the day-to-day expenses.
            </div>
          </div>
        </div>
      </div>
    </div>



  <h3>Who runs the municipality?</h3>
  {% for official in mayoral_staff %}
    <b>{{ official.role }}</b>
    <ul>
      <li>{{ official.title }} {{ official.name }}</li>
      <li>Phone: {{ official.office_phone }}</li>
      <li>Fax: {{ official.fax_number }}</li>
      <li>Email: {{ official.email }}</li>
    </ul>
  {% endfor %}

  <h2>Contact details:</h2>
  <ul>
    <li>{{ muni_contact.phone_number }}</li>
    <li><a href="{{ muni_contact.url }}">{{ muni_contact.url }}</a></li>
    <li>{{ muni_contact.street_address_1 }}, {{ muni_contact.street_address_2 }}, {{ muni_contact.street_address_3 }} {{ muni_contact.street_address_4 }}</li>
  </ul>

  <h2>Audit opinions:</h2>
  <ul>
    Results:
    {% for y, v in audit_opinions.iteritems %}
      <li>{{ y|unlocalize }}: {{ v }}</li>
    {% endfor %}
  </ul>

  <hr>
  <h3>Performance indicators</h3>
  <h2>Cash coverage:</h2>
  <ul>
    <b>Results:</b>
    {% for y, v in cash_coverage.iteritems %}
      <li>{{ y|unlocalize }}: {% if v %}{{ v }} {% else %} N/A {% endif %}</li>
    {% endfor %}
    <b>Formula:</b>
    <li>Cash available at year end / Operating Expenditure per month</li>
    <b>API details:</b>
    <li>Cash flow at year end: cube: cflow; item.code: 4200</li>
    <li>Operating Expenditure: cube: incexp, item.code: 4600, amount_type.label: Audited Actual</li>
  </ul>

  <h2>Cash balance at year end</h2>
  <ul>
    <b>Results:</b>
    {% for y, v in cash_at_year_end.iteritems %}
      <li>{{ y|unlocalize }}: {% if v %}{{ v }} {% else %} N/A {% endif %}</li>
    {% endfor %}
    <b>API details:</b>
    <li>Cash flow at year end: cube: cflow; item.code: 4200</li>
  </ul>

  <h2>Under(Over) spend of operating budget:</h2>
  <ul>
    <b>Results:</b>
    {% for y, v in op_budget_diff.iteritems %}
      <li>{{ y|unlocalize }}: {% if v %}{{ v }} % {% else %} N/A {% endif %}</li>
    {% endfor %}
    <b>Formula:</b>
    <li>(Budgeted Operating Expenditure - Actual Operating Expenditure) / Budgeted Operating Expenditure</li>
    <b>API details:</b>
    <li>Budgeted Operating Expenditure: cube: incexp; item.code: 4600; amount_type.label: Adjusted Budget</li>
    <li>Actual Operating Expenditure: cube: incexp, item.code: 4600, amount_type.label: Audited Actual</li>
  </ul>

  <h2>Under(Over) spend of capital budget</h2>
  <ul>
    <b>Results:</b>
    {% for y, v in cap_budget_diff.iteritems %}
      <li>{{ y|unlocalize }}: {% if v %}{{ v }} % {% else %} N/A {% endif %}</li>
    {% endfor %}
    <b>Formula:</b>
    <li>(Budgeted Capital Expenditure - Actual Capital Expenditure) / Budgeted Capital Expenditure</li>
    <b>API details:</b>
    <li>Budgeted Capital Expenditure: cube: capital; item.code: 4100; amount_type.label: Adjusted Budget</li>
    <li>Actual Capital Expenditure: cube: capital, item.code: 4100, amount_type.label: Audited Actual</li>
  </ul>

  <h2>Repairs and maintenance as a % of Property, plant and equipment:</h2>
  <ul>
    <b>Results:</b>
    {% for y, v in rep_maint_perc_ppe.iteritems %}
      <li>{{ y|unlocalize }}: {% if v %}{{ v }} % {% else %} N/A {% endif %}</li>
    {% endfor %}
    <b>Formula:</b>
    <li>Repairs and maintenance expenditure / (Property, Plant and Equipment + Investment Property)</li>
    API details:
    <li>Repairs and maintenance expenditure: cube: repmaint; item.code: 5005; amount_type.label: Audited Actual</li>
    <li>Property, Plant and Equipment: cube: bsheet; item.code: 1300; amount_type.label: Audited Actual</li>
    <li>Investment Property: cube: bsheet; item.code: 1401; amount_type.label: Audited Actual</li>
  </ul>
  <h2>Breakdown of revenue</h2>
  <ul>
    <b>Results:</b>
    {% for year, items in revenue_breakdown.iteritems %}
      <li>{{ year|unlocalize }}:</li>
        <ul>
          <li>Property rates: {{ items.property_rates }}</li>
          <li>Service charges: {{ items.service_charges }}</li>
          <li>Transfers received: {{ items.transfers_received }}</li>
          <li>Own revenue: {{ items.own_revenue }}</li>
          <li>Other: {{ items.other }}</li>
          <li>Total: {{ items.total }}</li>
        </ul>
    {% endfor %}
  </ul>
  <h2>Breakdown of expenditure</h2>
  <ul>
    <b>Results:</b>
    {% for year, items in expenditure_breakdown.iteritems %}
      <li>{{ year|unlocalize }}:</li>
        <ul>
          <li>Employee related costs: {{ items.employee_related_costs }}</li>
          <li>Councilor remuneration: {{ items.councillor_remuneration }}</li>
          <li>Bulk purchases: {{ items.bulk_purchases }}</li>
          <li>Contracted service: {{ items.contracted_services }}</li>
          <li>Transfers spent: {{ items.transfers_spent }}</li>
          <li>Depreciation and Amortisation: {{ items.depreciation_amortisation }}</li>
          <li>Other: {{ items.other }}</li>
          <li>Total: {{ items.total }}</li>
        </ul>
    {% endfor %}
  </ul>
</section>

{% endblock %}

{% block profile_javascript_libs %}
{{ block.super }}
<script src="{% static 'js/maps_mapit.js' %}"></script>
<script src="{% static 'js/profile_map_mapit.js' %}"></script>
{% endblock %}
